<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>webworkerTask</title>
    <!-- <link rel="stylesheet" href="./index.scss" /> -->
    <style>
      * {
        box-sizing: border-box;
      }

      html {
        background: #692a84;
        background: linear-gradient(316deg, #0e0f2a, #060913);
      }

      body {
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        overflow: hidden;
        height: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
      }

      #app {
        height: 100%;
        width: 100%;
      }
    </style>
    <!-- <script type="module" src="../dist/index.js"></script> -->
  </head>

  <body>
    <div id="app"></div>
    <script type="module">
      import {
        BoxGeometry,
        Mesh,
        PerspectiveCamera,
        Scene,
        PhongMaterial,
        Vector3,
        Color,
        SpotLight,
        PointLight,
        PbrBaseMaterial,
        Texture,
        Sampler,
        TorusKnotGeometry,
        SkyBox,
        CubeTextureLoader,
        SphereGeometry,
        PbrMat,
        loadTexture,
        OrbitControl,
      } from "../dist/index.js";

      const init = async () => {
        const geometry = new BoxGeometry(10, 10, 10);
        //const geometry=new TorusKnotGeometry(10, 3, 200, 32)
        //const geometry= new SphereGeometry();
        const img = document.createElement("img");
        img.src = "./brick_diffuse.jpg";
        await img.decode();
        const imageBitmap = await createImageBitmap(img);
        const phongMaterial = new PhongMaterial(imageBitmap);
        const baseSampler = new Sampler({
          magFilter: "linear",
          minFilter: "linear",
          addressModeU: "repeat",
          addressModeV: "repeat",
          addressModeW: "repeat",
        });
        const baseTexture = await loadTexture("./brick_diffuse.jpg");
        const aoTexture = await loadTexture(
          "./textures/AmbientOcclusionMap.png"
        );
        const normalTexture = await loadTexture("./textures/NormalMap.png");
        const environmentUrls = [
          `./textures/environment/px.jpg`,
          `./textures/environment/nx.jpg`,
          `./textures/environment/py.jpg`,
          `./textures/environment/ny.jpg`,
          `./textures/environment/pz.jpg`,
          `./textures/environment/nz.jpg`,
        ];
        const scene = new Scene({
          container: "app",
          brdfUrl: "./textures/brdfLUT.png",
          specularEnvUrls: environmentUrls,
          diffuseEnvUrls: [
            `./textures/environment/diffuse/bakedDiffuse_01.jpg`,
            `./textures/environment/diffuse/bakedDiffuse_02.jpg`,
            `./textures/environment/diffuse/bakedDiffuse_03.jpg`,
            `./textures/environment/diffuse/bakedDiffuse_04.jpg`,
            `./textures/environment/diffuse/bakedDiffuse_05.jpg`,
            `./textures/environment/diffuse/bakedDiffuse_06.jpg`,
          ],
        });
        const pbr = new PbrMat();
        pbr.baseTexture = baseTexture;
        pbr.baseSampler = baseSampler;
        pbr.aoTexture = aoTexture;
        pbr.normalTexture = normalTexture;
        pbr.roughness = 1.0;
        pbr.metalness = 0.0;
        const primitive = new Mesh(geometry, pbr);
        // primitive.scale.set(3,3,3)
        // primitive.rotateY(Math.PI/3)
        const camera = new PerspectiveCamera(
          60,
          window.innerWidth / window.innerHeight,
          0.01,
          1000
        );
        camera.position.set(25, 25, 25);
        camera.lookAt(0, 0, 0);

        const pointLight = new PointLight(
          new Vector3(1.0, 1.0, 1.0),
          10,
          65,
          1
        );
        pointLight.position = new Vector3(0, 25, 0);
        const skybox = new SkyBox(environmentUrls);
        scene.add(primitive);
        scene.add(skybox);
        scene.setCamera(camera);
        scene.addLight(pointLight);
        const control = new OrbitControl(
          camera,
          document.getElementById("app")
        );
        control.zoomSpeed = 2.0;
        control.maxPolarAngle = Math.PI / 2;
        function animate() {
          // primitive.rotateY(0.01)
          // primitive.rotateX(0.01)
          requestAnimationFrame(animate);
          control.update();
          scene.render();
        }
        // document.body.appendChild(scene.context.canvas);
        animate();
        //scene.render()
      };
      init();

      const json = {
        types: [
          { value: "feat", name: "feat: 新功能" },
          { value: "fix", name: "fix: 修复" },
          { value: "docs", name: "docs: ⽂档变更" },
          { value: "style", name: "style: 代码格式(不影响代码运⾏的变动)" },
          {
            value: "refactor",
            name: "refactor: 重构(既不是增加feature，也不是修复bug)",
          },
          { value: "perf", name: "perf: 性能优化" },
          { value: "test", name: "test: 增加测试" },
          { value: "chore", name: "chore: 构建过程或辅助⼯具的变动" },
          { value: "revert", name: "revert: 回退" },
          { value: "build", name: "build: 打包" },
        ],
        // 消息步骤
        messages: {
          type: "请选择提交类型:",
          customScope: "请输⼊修改范围(可选):",
          subject: "请简要描述提交(必填):",
          body: "请输⼊详细描述(可选):",
          footer: "请输⼊要关闭的issue(可选):",
          confirmCommit: "确认使⽤以上信息提交？(y/n/e/h)",
        },
        // 跳过问题
        skipQuestions: ["body", "footer"],
        // subject⽂字⻓度默认是72
        subjectLimit: 72,
      };
    </script>
  </body>
</html>
